{"version":3,"sources":["../../../../src/modules/website/site/site.service.ts"],"sourcesContent":["import { BadRequestException, Inject, Injectable } from '@nestjs/common';\nimport { InjectRepository } from '@nestjs/typeorm';\nimport { Repository } from 'typeorm';\n\nimport { MESSAGES } from '@/constants';\nimport { WebSiteInfoEntity } from '@/database';\nimport { ContextService } from '@/shared';\nimport { UpdateConfigDTO } from './site.dto';\n\n@Injectable()\nexport class SiteService {\n  constructor(\n    @InjectRepository(WebSiteInfoEntity)\n    private siteModel: Repository<WebSiteInfoEntity>,\n    private contextService: ContextService,\n  ) {}\n\n  // 获取网站配置\n  async handleGetSiteInfo(id: string) {\n    const info = await this.siteModel.findOneBy({ id });\n    return info;\n  }\n\n  // 更新网站配置\n  async handleUpdateSiteInfo(id: string, dto: UpdateConfigDTO) {\n    const { userName } = this.contextService.getPayload();\n    const existConfig = await this.siteModel.findOneBy({ id });\n    if (!existConfig) {\n      throw new BadRequestException(MESSAGES.CONFIG_NOT_EXIST);\n    }\n    // save方法会自动更新updateTime\n    await this.siteModel.save({ ...dto, updateBy: userName });\n    // update方法更新数据 需要手动更新updateTime\n    // await this.siteModel.update(id, {\n    //   ...dto,\n    //   updateBy: userName,\n    //   updateTime: new Date(),\n    // });\n  }\n}\n"],"names":["SiteService","handleGetSiteInfo","id","info","siteModel","findOneBy","handleUpdateSiteInfo","dto","userName","contextService","getPayload","existConfig","BadRequestException","MESSAGES","CONFIG_NOT_EXIST","save","updateBy","constructor","Injectable","InjectRepository","WebSiteInfoEntity"],"rangeMappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;","mappings":";;;;+BAUaA;;;eAAAA;;;wBAV2C;yBACvB;0BACN;2BAEF;0BACS;wBACH;;;;;;;;;;;;;;;AAIxB,IAAA,AAAMA,cAAN,MAAMA;IAOX,SAAS;IACT,MAAMC,kBAAkBC,EAAU,EAAE;QAClC,MAAMC,OAAO,MAAM,IAAI,CAACC,SAAS,CAACC,SAAS,CAAC;YAAEH;QAAG;QACjD,OAAOC;IACT;IAEA,SAAS;IACT,MAAMG,qBAAqBJ,EAAU,EAAEK,GAAoB,EAAE;QAC3D,MAAM,EAAEC,QAAQ,EAAE,GAAG,IAAI,CAACC,cAAc,CAACC,UAAU;QACnD,MAAMC,cAAc,MAAM,IAAI,CAACP,SAAS,CAACC,SAAS,CAAC;YAAEH;QAAG;QACxD,IAAI,CAACS,aAAa;YAChB,MAAM,IAAIC,2BAAmB,CAACC,mBAAQ,CAACC,gBAAgB;QACzD;QACA,wBAAwB;QACxB,MAAM,IAAI,CAACV,SAAS,CAACW,IAAI,CAAC;YAAE,GAAGR,GAAG;YAAES,UAAUR;QAAS;IACvD,gCAAgC;IAChC,oCAAoC;IACpC,YAAY;IACZ,wBAAwB;IACxB,4BAA4B;IAC5B,MAAM;IACR;IA3BAS,YACE,AACQb,SAAwC,EAChD,AAAQK,cAA8B,CACtC;aAFQL,YAAAA;aACAK,iBAAAA;IACP;AAwBL;AA7BaT;IADZkB,IAAAA,kBAAU;IAGNC,aAAAA,IAAAA,yBAAgB,EAACC,2BAAiB;;;eAChB,oBAAU,4BAAV,oBAAU;eACL,sBAAc,4BAAd,sBAAc;;GAJ7BpB"}