{"version":3,"sources":["../../../../src/modules/system/role/role.controller.ts"],"sourcesContent":["import { Body, Controller, Delete, Post, Put, Query } from '@nestjs/common';\nimport {\n  ApiBearerAuth,\n  ApiOkResponse,\n  ApiOperation,\n  ApiQuery,\n  ApiTags,\n} from '@nestjs/swagger';\n\nimport { ENTITY_BIZ_TYPE } from '@/constants';\nimport { OperLog, Permission } from '@/decorators';\nimport { DelDTO, ExportResultVO } from '@/models';\n\nimport {\n  AllocateDTO,\n  CreateRoleDTO,\n  FindAllocatedPageDTO,\n  FindRolePageDTO,\n  FindUnallocatedPageDTO,\n  UpdateRoleDTO,\n} from './role.dto';\nimport { RoleService } from './role.service';\nimport {\n  FindAllocatedPageVO,\n  FindRolePageVO,\n  FindUnallocatedPageVO,\n} from './role.vo';\n\n@ApiTags('角色接口')\n@ApiBearerAuth()\n@Controller('/system/role')\nexport class RoleController {\n  constructor(private roleService: RoleService) {}\n\n  @ApiOperation({ summary: '查询角色分页' })\n  @ApiOkResponse({ type: FindRolePageVO })\n  @Permission('system:role:list')\n  @Post('/page')\n  async findPage(@Body() dto: FindRolePageDTO) {\n    return await this.roleService.handleFindPage(dto);\n  }\n\n  @ApiOperation({ summary: '新增角色' })\n  @OperLog({ title: '角色管理', bizType: ENTITY_BIZ_TYPE.INSERT })\n  @Permission('system:role:add')\n  @Post('/create')\n  async create(@Body() dto: CreateRoleDTO) {\n    await this.roleService.handleCreate(dto);\n  }\n\n  @ApiOperation({ summary: '更新角色' })\n  @ApiQuery({ name: 'id', description: '主键' })\n  @OperLog({ title: '角色管理', bizType: ENTITY_BIZ_TYPE.UPDATE })\n  @Permission('system:role:edit')\n  @Put('/update')\n  async update(@Query('id') id: string, @Body() dto: UpdateRoleDTO) {\n    await this.roleService.handleUpdate(id, dto);\n  }\n\n  @ApiOperation({ summary: '删除角色' })\n  @OperLog({ title: '角色管理', bizType: ENTITY_BIZ_TYPE.DELETE })\n  @Permission('system:role:remove')\n  @Delete('/delete')\n  async deleteMany(@Body() dto: DelDTO) {\n    await this.roleService.handleDeleteMany(dto);\n  }\n\n  @ApiOperation({ summary: '导出角色分页' })\n  @ApiOkResponse({ type: ExportResultVO })\n  @OperLog({ title: '角色管理', bizType: ENTITY_BIZ_TYPE.EXPORT })\n  @Permission('system:role:export')\n  @Post('/export')\n  async exportPage(@Body() dto: FindRolePageDTO) {\n    return await this.roleService.handleExportPage(dto);\n  }\n\n  @ApiOperation({ summary: '切换角色状态' })\n  @ApiQuery({ name: 'id', description: '主键' })\n  @OperLog({ title: '角色管理', bizType: ENTITY_BIZ_TYPE.UPDATE })\n  @Permission('system:role:edit')\n  @Put('/toggleStatus')\n  async toggleStatus(@Query('id') id: string) {\n    await this.roleService.handleToggleStatus(id);\n  }\n\n  @ApiOperation({ summary: '获取角色绑定的用户分页' })\n  @ApiOkResponse({ type: FindAllocatedPageVO })\n  @ApiQuery({ name: 'id', description: '主键' })\n  @Permission('system:role:list')\n  @Post('/allocatedPage')\n  async findAllocatedPage(\n    @Query('id') id: string,\n    @Body() dto: FindAllocatedPageDTO,\n  ) {\n    return await this.roleService.handleFindAllocatedPage(id, dto);\n  }\n\n  @ApiOperation({ summary: '取消角色绑定的用户' })\n  @ApiQuery({ name: 'id', description: '主键' })\n  @OperLog({ title: '角色管理', bizType: ENTITY_BIZ_TYPE.GRANT })\n  @Permission('system:role:edit')\n  @Put('/cancelAllocated')\n  async cancelAllocated(@Query('id') id: string, @Body() dto: DelDTO) {\n    await this.roleService.handleCancelAllocated(id, dto);\n  }\n\n  @ApiOperation({ summary: '获取未绑定角色的用户分页' })\n  @ApiOkResponse({ type: FindUnallocatedPageVO })\n  @ApiQuery({ name: 'id', description: '主键' })\n  @Permission('system:role:list')\n  @Post('/unallocatedPage')\n  async findUnallocatedPage(\n    @Query('id') id: string,\n    @Body() dto: FindUnallocatedPageDTO,\n  ) {\n    return await this.roleService.handleFindUnallocatedPage(id, dto);\n  }\n\n  @ApiOperation({ summary: '角色绑定用户' })\n  @ApiQuery({ name: 'id', description: '主键' })\n  @OperLog({ title: '角色管理', bizType: ENTITY_BIZ_TYPE.GRANT })\n  @Permission('system:role:edit')\n  @Put('/allocate')\n  async allocate(@Query('id') id: string, @Body() dto: AllocateDTO) {\n    await this.roleService.handleAllocate(id, dto);\n  }\n}\n"],"names":["RoleController","findPage","dto","roleService","handleFindPage","create","handleCreate","update","id","handleUpdate","deleteMany","handleDeleteMany","exportPage","handleExportPage","toggleStatus","handleToggleStatus","findAllocatedPage","handleFindAllocatedPage","cancelAllocated","handleCancelAllocated","findUnallocatedPage","handleFindUnallocatedPage","allocate","handleAllocate","constructor","ApiOperation","summary","ApiOkResponse","type","FindRolePageVO","Permission","Post","Body","OperLog","title","bizType","ENTITY_BIZ_TYPE","INSERT","ApiQuery","name","description","UPDATE","Put","Query","DELETE","Delete","ExportResultVO","EXPORT","FindAllocatedPageVO","GRANT","FindUnallocatedPageVO","ApiTags","ApiBearerAuth","Controller"],"rangeMappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;","mappings":"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"}