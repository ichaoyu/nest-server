{"version":3,"sources":["../../src/interceptors/response.interceptor.ts"],"sourcesContent":["import {\n  CallHandler,\n  ExecutionContext,\n  HttpStatus,\n  Injectable,\n  NestInterceptor,\n  Scope,\n} from '@nestjs/common';\nimport { ConfigService } from '@nestjs/config';\nimport { map } from 'rxjs';\n\nimport { MESSAGES } from '@/constants';\nimport { IRequest } from '@/interfaces';\n\n/**\n * 响应拦截器\n */\n@Injectable({\n  scope: Scope.REQUEST,\n})\nexport class ResponseInterceptor implements NestInterceptor {\n  constructor(private configService: ConfigService) {}\n\n  async intercept(context: ExecutionContext, next: CallHandler) {\n    const request = context.switchToHttp().getRequest<IRequest>();\n    const apiPath = this.configService.get<string>('app.apiPath');\n    const isApi = request.url.includes(apiPath);\n\n    if (!isApi) {\n      return next.handle();\n    }\n\n    return next.handle().pipe(\n      map((data) => ({\n        timestamp: Date.now(),\n        code: HttpStatus.OK,\n        msg: MESSAGES.REQUEST_OK,\n        data,\n      })),\n    );\n  }\n}\n"],"names":["ResponseInterceptor","intercept","context","next","request","switchToHttp","getRequest","apiPath","configService","get","isApi","url","includes","handle","pipe","map","data","timestamp","Date","now","code","HttpStatus","OK","msg","MESSAGES","REQUEST_OK","constructor","Injectable","scope","Scope","REQUEST"],"rangeMappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;","mappings":";;;;+BAoBaA;;;eAAAA;;;wBAbN;wBACuB;sBACV;2BAEK;;;;;;;;;;AASlB,IAAA,AAAMA,sBAAN,MAAMA;IAGX,MAAMC,UAAUC,OAAyB,EAAEC,IAAiB,EAAE;QAC5D,MAAMC,UAAUF,QAAQG,YAAY,GAAGC,UAAU;QACjD,MAAMC,UAAU,IAAI,CAACC,aAAa,CAACC,GAAG,CAAS;QAC/C,MAAMC,QAAQN,QAAQO,GAAG,CAACC,QAAQ,CAACL;QAEnC,IAAI,CAACG,OAAO;YACV,OAAOP,KAAKU,MAAM;QACpB;QAEA,OAAOV,KAAKU,MAAM,GAAGC,IAAI,CACvBC,IAAAA,SAAG,EAAC,CAACC,OAAU,CAAA;gBACbC,WAAWC,KAAKC,GAAG;gBACnBC,MAAMC,kBAAU,CAACC,EAAE;gBACnBC,KAAKC,mBAAQ,CAACC,UAAU;gBACxBT;YACF,CAAA;IAEJ;IAnBAU,YAAY,AAAQlB,aAA4B,CAAE;aAA9BA,gBAAAA;IAA+B;AAoBrD;AArBaR;IAHZ2B,IAAAA,kBAAU,EAAC;QACVC,OAAOC,aAAK,CAACC,OAAO;IACtB;;;eAEqC,qBAAa,4BAAb,qBAAa;;GADrC9B"}