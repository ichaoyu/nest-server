{"version":3,"sources":["../../../src/shared/redis/redis.module.ts"],"sourcesContent":["import { DynamicModule, Inject, Module, OnModuleDestroy } from '@nestjs/common';\n\nimport { RedisClient, RedisCluster, RedisModuleOptions } from '@/interfaces';\nimport { createFactory, createRedisCommonOptions } from './redis.providers';\n\nexport class RedisModule {\n  static registerAsync(params: RedisModuleOptions) {\n    const { global, createType, clientToken, optionsToken, optionsProvider } =\n      params;\n\n    @Module({})\n    class RedisCoreModule implements OnModuleDestroy {\n      constructor(\n        @Inject(clientToken)\n        private readonly client: RedisClient | RedisCluster,\n      ) {}\n\n      static create(): DynamicModule {\n        return {\n          module: RedisCoreModule,\n          global,\n          providers: [\n            createRedisCommonOptions(optionsToken, optionsProvider),\n            createFactory(createType)(clientToken, optionsToken),\n          ],\n          exports: [clientToken],\n        };\n      }\n\n      async onModuleDestroy() {\n        await this.client.quit();\n      }\n    }\n\n    return RedisCoreModule.create();\n  }\n}\n"],"names":["RedisModule","registerAsync","params","global","createType","clientToken","optionsToken","optionsProvider","RedisCoreModule","create","module","providers","createRedisCommonOptions","createFactory","exports","onModuleDestroy","client","quit","constructor","Module","Inject"],"rangeMappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;","mappings":";;;;+BAKaA;;;eAAAA;;;wBALkD;gCAGP;;;;;;;;;;;;;;;AAEjD,IAAA,AAAMA,cAAN,MAAMA;IACX,OAAOC,cAAcC,MAA0B,EAAE;QAC/C,MAAM,EAAEC,MAAM,EAAEC,UAAU,EAAEC,WAAW,EAAEC,YAAY,EAAEC,eAAe,EAAE,GACtEL;QAEF,IAAA,AACMM,kBADN,MACMA;YAMJ,OAAOC,SAAwB;gBAC7B,OAAO;oBACLC,QAAQF;oBACRL;oBACAQ,WAAW;wBACTC,IAAAA,wCAAwB,EAACN,cAAcC;wBACvCM,IAAAA,6BAAa,EAACT,YAAYC,aAAaC;qBACxC;oBACDQ,SAAS;wBAACT;qBAAY;gBACxB;YACF;YAEA,MAAMU,kBAAkB;gBACtB,MAAM,IAAI,CAACC,MAAM,CAACC,IAAI;YACxB;YAnBAC,YACE,AACiBF,MAAkC,CACnD;qBADiBA,SAAAA;YAChB;QAiBL;QArBMR;YADLW,IAAAA,cAAM,EAAC,CAAC;YAGJC,aAAAA,IAAAA,cAAM,EAACf;;;;;WAFNG;QAuBN,OAAOA,gBAAgBC,MAAM;IAC/B;AACF"}