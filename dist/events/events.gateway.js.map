{"version":3,"sources":["../../src/events/events.gateway.ts"],"sourcesContent":["import { UseFilters, UseGuards } from '@nestjs/common';\nimport {\n  SubscribeMessage,\n  WebSocketGateway,\n  WebSocketServer,\n  WsResponse,\n} from '@nestjs/websockets';\nimport { Observable, interval, map, mergeAll } from 'rxjs';\nimport { Server } from 'ws';\n\nimport { EVENTS } from '@/constants';\nimport { Permission } from '@/decorators';\nimport { WsDefaultFilter } from '@/filters';\nimport { WsAuthGuard } from '@/guards';\n\nimport { EventsService } from './events.service';\n\n@WebSocketGateway({ cors: true, transports: ['websocket'] })\n@UseGuards(WsAuthGuard)\n@UseFilters(WsDefaultFilter)\nexport class EventsGateway {\n  constructor(private eventsService: EventsService) {}\n\n  @WebSocketServer()\n  server: Server;\n\n  @SubscribeMessage(EVENTS.SERVER_INFO)\n  @Permission('monitor:server:list')\n  getServerInfo(): Observable<WsResponse<any>> {\n    return interval(1000).pipe(\n      map(async () => {\n        const data = await this.eventsService.handleGetInfo();\n\n        return { event: EVENTS.SERVER_INFO, data };\n      }),\n      mergeAll(),\n    );\n  }\n}\n"],"names":["EventsGateway","getServerInfo","interval","pipe","map","data","eventsService","handleGetInfo","event","EVENTS","SERVER_INFO","mergeAll","constructor","WebSocketServer","SubscribeMessage","Permission","WebSocketGateway","cors","transports","UseGuards","WsAuthGuard","UseFilters","WsDefaultFilter"],"rangeMappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;","mappings":";;;;+BAoBaA;;;eAAAA;;;wBApByB;4BAM/B;sBAC6C;oBAC7B;2BAEA;4BACI;yBACK;wBACJ;+BAEE;;;;;;;;;;AAKvB,IAAA,AAAMA,gBAAN,MAAMA;IAQXC,gBAA6C;QAC3C,OAAOC,IAAAA,cAAQ,EAAC,MAAMC,IAAI,CACxBC,IAAAA,SAAG,EAAC;YACF,MAAMC,OAAO,MAAM,IAAI,CAACC,aAAa,CAACC,aAAa;YAEnD,OAAO;gBAAEC,OAAOC,iBAAM,CAACC,WAAW;gBAAEL;YAAK;QAC3C,IACAM,IAAAA,cAAQ;IAEZ;IAhBAC,YAAY,AAAQN,aAA4B,CAAE;aAA9BA,gBAAAA;IAA+B;AAiBrD;;IAfGO,IAAAA,2BAAe;uCACR,UAAM,4BAAN,UAAM;GAJHb;;IAMVc,IAAAA,4BAAgB,EAACL,iBAAM,CAACC,WAAW;IACnCK,IAAAA,sBAAU,EAAC;;;6CACK,gBAAU,4BAAV,gBAAU;GARhBf;AAAAA;IAHZgB,IAAAA,4BAAgB,EAAC;QAAEC,MAAM;QAAMC,YAAY;YAAC;SAAY;IAAC;IACzDC,IAAAA,iBAAS,EAACC,mBAAW;IACrBC,IAAAA,kBAAU,EAACC,wBAAe;;;eAEU,4BAAa,4BAAb,4BAAa;;GADrCtB"}