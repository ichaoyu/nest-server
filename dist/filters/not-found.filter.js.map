{"version":3,"sources":["../../src/filters/not-found.filter.ts"],"sourcesContent":["import {\n  ArgumentsHost,\n  Catch,\n  ExceptionFilter,\n  NotFoundException,\n} from '@nestjs/common';\nimport { ConfigService } from '@nestjs/config';\nimport { HttpAdapterHost } from '@nestjs/core';\nimport { InjectPinoLogger, PinoLogger } from 'nestjs-pino';\n\nimport { MESSAGES } from '@/constants';\nimport { IRequest } from '@/interfaces';\n\n/**\n * 资源不存在错误处理\n */\n@Catch(NotFoundException)\nexport class NotFoundFilter implements ExceptionFilter {\n  constructor(\n    @InjectPinoLogger(NotFoundFilter.name)\n    private loggerService: PinoLogger,\n    private configService: ConfigService,\n    private httpAdapterHost: HttpAdapterHost,\n  ) {}\n\n  catch(exception: NotFoundException, host: ArgumentsHost) {\n    const { httpAdapter } = this.httpAdapterHost;\n    const apiPath = this.configService.get<string>('app.apiPath');\n    const ctx = host.switchToHttp();\n    const code = exception.getStatus();\n    const req = ctx.getRequest<IRequest>();\n    const isApi = req.url.includes(apiPath);\n\n    if (isApi) {\n      this.loggerService.error(exception.stack);\n      const msg = `${MESSAGES.NOT_FOUND}: ${exception.message}`;\n\n      httpAdapter.reply(\n        ctx.getResponse(),\n        {\n          code,\n          msg,\n        },\n        code,\n      );\n    }\n  }\n}\n"],"names":["NotFoundFilter","catch","exception","host","httpAdapter","httpAdapterHost","apiPath","configService","get","ctx","switchToHttp","code","getStatus","req","getRequest","isApi","url","includes","loggerService","error","stack","msg","MESSAGES","NOT_FOUND","message","reply","getResponse","constructor","Catch","NotFoundException","InjectPinoLogger","name"],"rangeMappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;","mappings":";;;;+BAiBaA;;;eAAAA;;;wBAZN;wBACuB;sBACE;4BACa;2BAEpB;;;;;;;;;;;;;;;AAOlB,IAAA,AAAMA,iBAAN,MAAMA;IAQXC,MAAMC,SAA4B,EAAEC,IAAmB,EAAE;QACvD,MAAM,EAAEC,WAAW,EAAE,GAAG,IAAI,CAACC,eAAe;QAC5C,MAAMC,UAAU,IAAI,CAACC,aAAa,CAACC,GAAG,CAAS;QAC/C,MAAMC,MAAMN,KAAKO,YAAY;QAC7B,MAAMC,OAAOT,UAAUU,SAAS;QAChC,MAAMC,MAAMJ,IAAIK,UAAU;QAC1B,MAAMC,QAAQF,IAAIG,GAAG,CAACC,QAAQ,CAACX;QAE/B,IAAIS,OAAO;YACT,IAAI,CAACG,aAAa,CAACC,KAAK,CAACjB,UAAUkB,KAAK;YACxC,MAAMC,MAAM,CAAC,EAAEC,mBAAQ,CAACC,SAAS,CAAC,EAAE,EAAErB,UAAUsB,OAAO,CAAC,CAAC;YAEzDpB,YAAYqB,KAAK,CACfhB,IAAIiB,WAAW,IACf;gBACEf;gBACAU;YACF,GACAV;QAEJ;IACF;IA5BAgB,YACE,AACQT,aAAyB,EACjC,AAAQX,aAA4B,EACpC,AAAQF,eAAgC,CACxC;aAHQa,gBAAAA;aACAX,gBAAAA;aACAF,kBAAAA;IACP;AAwBL;AA9BaL;IADZ4B,IAAAA,aAAK,EAACC,yBAAiB;IAGnBC,aAAAA,IAAAA,4BAAgB,EAAC9B,eAAe+B,IAAI;;;eACd,sBAAU,4BAAV,sBAAU;eACV,qBAAa,4BAAb,qBAAa;eACX,qBAAe,4BAAf,qBAAe;;GAL/B/B"}