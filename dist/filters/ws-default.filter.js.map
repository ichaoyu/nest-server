{"version":3,"sources":["../../src/filters/ws-default.filter.ts"],"sourcesContent":["import { ArgumentsHost, Catch, HttpStatus } from '@nestjs/common';\nimport { BaseWsExceptionFilter, WsException } from '@nestjs/websockets';\nimport { InjectPinoLogger, PinoLogger } from 'nestjs-pino';\n\n/**\n * 默认错误处理\n */\n@Catch()\nexport class WsDefaultFilter extends BaseWsExceptionFilter {\n  constructor(\n    @InjectPinoLogger(WsDefaultFilter.name)\n    private loggerService: PinoLogger,\n  ) {\n    super();\n  }\n\n  catch(exception: unknown, host: ArgumentsHost) {\n    const ctx = host.switchToWs();\n    const client = ctx.getClient<WebSocket>();\n\n    const error =\n      exception instanceof WsException ? exception.getError() : exception;\n    const data =\n      error instanceof Error\n        ? {\n            status: HttpStatus.INTERNAL_SERVER_ERROR,\n            message: error.message,\n          }\n        : error;\n\n    this.loggerService.error(error);\n\n    client.send(\n      JSON.stringify({\n        event: 'error',\n        data,\n      }),\n    );\n  }\n}\n"],"names":["WsDefaultFilter","BaseWsExceptionFilter","catch","exception","host","ctx","switchToWs","client","getClient","error","WsException","getError","data","Error","status","HttpStatus","INTERNAL_SERVER_ERROR","message","loggerService","send","JSON","stringify","event","constructor","Catch","InjectPinoLogger","name"],"rangeMappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;","mappings":";;;;+BAQaA;;;eAAAA;;;wBARoC;4BACE;4BACN;;;;;;;;;;;;;;;AAMtC,IAAA,AAAMA,kBAAN,MAAMA,wBAAwBC,iCAAqB;IAQxDC,MAAMC,SAAkB,EAAEC,IAAmB,EAAE;QAC7C,MAAMC,MAAMD,KAAKE,UAAU;QAC3B,MAAMC,SAASF,IAAIG,SAAS;QAE5B,MAAMC,QACJN,qBAAqBO,uBAAW,GAAGP,UAAUQ,QAAQ,KAAKR;QAC5D,MAAMS,OACJH,iBAAiBI,QACb;YACEC,QAAQC,kBAAU,CAACC,qBAAqB;YACxCC,SAASR,MAAMQ,OAAO;QACxB,IACAR;QAEN,IAAI,CAACS,aAAa,CAACT,KAAK,CAACA;QAEzBF,OAAOY,IAAI,CACTC,KAAKC,SAAS,CAAC;YACbC,OAAO;YACPV;QACF;IAEJ;IA7BAW,YACE,AACQL,aAAyB,CACjC;QACA,KAAK;aAFGA,gBAAAA;IAGV;AAyBF;AA/BalB;IADZwB,IAAAA,aAAK;IAGDC,aAAAA,IAAAA,4BAAgB,EAACzB,gBAAgB0B,IAAI;;;eACf,sBAAU,4BAAV,sBAAU;;GAHxB1B"}