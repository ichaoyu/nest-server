{"version":3,"sources":["../../src/filters/validation.filter.ts"],"sourcesContent":["import {\n  ArgumentsHost,\n  Catch,\n  ExceptionFilter,\n  UnprocessableEntityException,\n} from '@nestjs/common';\nimport { HttpAdapterHost } from '@nestjs/core';\nimport { InjectPinoLogger, PinoLogger } from 'nestjs-pino';\n\nimport { MESSAGES } from '@/constants';\n\n/**\n * 参数校验错误处理\n */\n@Catch(UnprocessableEntityException)\nexport class ValidationFilter implements ExceptionFilter {\n  constructor(\n    @InjectPinoLogger(ValidationFilter.name)\n    private loggerService: PinoLogger,\n    private httpAdapterHost: HttpAdapterHost,\n  ) {}\n\n  catch(exception: UnprocessableEntityException, host: ArgumentsHost) {\n    const { httpAdapter } = this.httpAdapterHost;\n    const ctx = host.switchToHttp();\n    const code = exception.getStatus();\n\n    this.loggerService.error(exception.stack);\n\n    httpAdapter.reply(\n      ctx.getResponse(),\n      {\n        code,\n        msg: `${MESSAGES.UNPROCESSABLE_ENTITY}: ${exception.message}`,\n      },\n      code,\n    );\n  }\n}\n"],"names":["ValidationFilter","catch","exception","host","httpAdapter","httpAdapterHost","ctx","switchToHttp","code","getStatus","loggerService","error","stack","reply","getResponse","msg","MESSAGES","UNPROCESSABLE_ENTITY","message","constructor","Catch","UnprocessableEntityException","InjectPinoLogger","name"],"rangeMappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;","mappings":";;;;+BAeaA;;;eAAAA;;;wBAVN;sBACyB;4BACa;2BAEpB;;;;;;;;;;;;;;;AAMlB,IAAA,AAAMA,mBAAN,MAAMA;IAOXC,MAAMC,SAAuC,EAAEC,IAAmB,EAAE;QAClE,MAAM,EAAEC,WAAW,EAAE,GAAG,IAAI,CAACC,eAAe;QAC5C,MAAMC,MAAMH,KAAKI,YAAY;QAC7B,MAAMC,OAAON,UAAUO,SAAS;QAEhC,IAAI,CAACC,aAAa,CAACC,KAAK,CAACT,UAAUU,KAAK;QAExCR,YAAYS,KAAK,CACfP,IAAIQ,WAAW,IACf;YACEN;YACAO,KAAK,CAAC,EAAEC,mBAAQ,CAACC,oBAAoB,CAAC,EAAE,EAAEf,UAAUgB,OAAO,CAAC,CAAC;QAC/D,GACAV;IAEJ;IArBAW,YACE,AACQT,aAAyB,EACjC,AAAQL,eAAgC,CACxC;aAFQK,gBAAAA;aACAL,kBAAAA;IACP;AAkBL;AAvBaL;IADZoB,IAAAA,aAAK,EAACC,oCAA4B;IAG9BC,aAAAA,IAAAA,4BAAgB,EAACtB,iBAAiBuB,IAAI;;;eAChB,sBAAU,4BAAV,sBAAU;eACR,qBAAe,4BAAf,qBAAe;;GAJ/BvB"}