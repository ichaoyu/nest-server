{"version":3,"sources":["../../src/filters/default.filter.ts"],"sourcesContent":["import {\n  ArgumentsHost,\n  Catch,\n  ExceptionFilter,\n  HttpException,\n  HttpStatus,\n} from '@nestjs/common';\nimport { HttpAdapterHost } from '@nestjs/core';\nimport { InjectPinoLogger, PinoLogger } from 'nestjs-pino';\n\nimport { MESSAGES } from '@/constants';\n\n/**\n * 默认错误处理\n */\n@Catch()\nexport class DefaultFilter implements ExceptionFilter {\n  constructor(\n    @InjectPinoLogger(DefaultFilter.name)\n    private loggerService: PinoLogger,\n    private httpAdapterHost: HttpAdapterHost,\n  ) {}\n\n  catch(exception: unknown, host: ArgumentsHost) {\n    const { httpAdapter } = this.httpAdapterHost;\n    const ctx = host.switchToHttp();\n    const code =\n      exception instanceof HttpException\n        ? exception.getStatus()\n        : HttpStatus.INTERNAL_SERVER_ERROR;\n    const msg =\n      exception instanceof HttpException\n        ? exception.message\n        : MESSAGES.INTERNAL_SERVER_ERROR;\n\n    // @ts-ignore\n    this.loggerService.error(exception.stack);\n\n    // // statusCode统一返回200，具体错误处理在返回体里\n    httpAdapter.reply(\n      ctx.getResponse(),\n      {\n        code,\n        msg,\n      },\n      code,\n    );\n  }\n}\n"],"names":["DefaultFilter","catch","exception","host","httpAdapter","httpAdapterHost","ctx","switchToHttp","code","HttpException","getStatus","HttpStatus","INTERNAL_SERVER_ERROR","msg","message","MESSAGES","loggerService","error","stack","reply","getResponse","constructor","Catch","InjectPinoLogger","name"],"rangeMappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;","mappings":";;;;+BAgBaA;;;eAAAA;;;wBAVN;sBACyB;4BACa;2BAEpB;;;;;;;;;;;;;;;AAMlB,IAAA,AAAMA,gBAAN,MAAMA;IAOXC,MAAMC,SAAkB,EAAEC,IAAmB,EAAE;QAC7C,MAAM,EAAEC,WAAW,EAAE,GAAG,IAAI,CAACC,eAAe;QAC5C,MAAMC,MAAMH,KAAKI,YAAY;QAC7B,MAAMC,OACJN,qBAAqBO,qBAAa,GAC9BP,UAAUQ,SAAS,KACnBC,kBAAU,CAACC,qBAAqB;QACtC,MAAMC,MACJX,qBAAqBO,qBAAa,GAC9BP,UAAUY,OAAO,GACjBC,mBAAQ,CAACH,qBAAqB;QAEpC,aAAa;QACb,IAAI,CAACI,aAAa,CAACC,KAAK,CAACf,UAAUgB,KAAK;QAExC,mCAAmC;QACnCd,YAAYe,KAAK,CACfb,IAAIc,WAAW,IACf;YACEZ;YACAK;QACF,GACAL;IAEJ;IA9BAa,YACE,AACQL,aAAyB,EACjC,AAAQX,eAAgC,CACxC;aAFQW,gBAAAA;aACAX,kBAAAA;IACP;AA2BL;AAhCaL;IADZsB,IAAAA,aAAK;IAGDC,aAAAA,IAAAA,4BAAgB,EAACvB,cAAcwB,IAAI;;;eACb,sBAAU,4BAAV,sBAAU;eACR,qBAAe,4BAAf,qBAAe;;GAJ/BxB"}